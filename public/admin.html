<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">

        <meta name="viewport" content="width=device-width"/>

        <title>Validata: Admin</title>

        <link rel="icon" type="image/png" href="components/material-design-icons/action/drawable-hdpi/ic_spellcheck_black_48dp.png"/>
        
        <link rel="stylesheet" href="components/bootstrap/dist/css/bootstrap.css"/>
        <link rel="stylesheet" href="components/bootstrap-switch/dist/css/bootstrap3/bootstrap-switch.min.css"/>
        <link rel="stylesheet" href="components/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" />
        <!--<link rel="stylesheet" href="components/bootstrap-tagsinput/dist/bootstrap-tagsinput.css"/>-->

        <link rel="stylesheet" href="components/animate.css/animate.css"/>

        <link rel="stylesheet" href="components/codemirror/lib/codemirror.css"/>

        <link rel="stylesheet" href="stylesheets/vendor/material-design-icons.css"/>

        <link rel="stylesheet" href="stylesheets/media-sizes.css"/>
        <style>
            .input-group {
                margin-bottom: 10px;
            }
            /* these are special */
            .slip-reordering {
                box-shadow: 0 2px 10px rgba(0,0,0,0.45);
            }

            .slip-swiping-container {
                overflow-x: hidden;
            }

            #slippylist > li {
                user-select: none;
                -moz-user-select: none;
                -webkit-user-select: none;
                cursor: default;
                display:block;
                border: 1px solid rgba(0,0,0,0.2);
                background: white;
                margin: 0;
                border-radius: 0;
                margin-bottom: -1px;
                max-width: 100%;
                /*line-height: 3;*/
                vertical-align: middle;
            }

            #slippylist > li:first-child {
                border-top-left-radius: 5px;
                border-top-right-radius: 5px;
            }
            #slippylist > li:last-child {
                border-bottom-left-radius: 5px;
                border-bottom-right-radius: 5px;
            }

            /* the rest is junk for the demo page */
            #slippylist > li {
                padding: 0;
                /*line-height: 1.3;*/
                user-select: text;
                -moz-user-select: text;
                -webkit-user-select: text;
            }
            #slippylist span {
                cursor: text;
            }

            #slippylist {
                clear:left;
                padding: 0 0 1px;
            }

            /*#slippylist input {
                vertical-align: middle;
            }*/

            #slippylist > li.demo-allow-select {
                padding: 1em;
                /*line-height: 1.3;*/
                user-select: text;
                -moz-user-select: text;
                -webkit-user-select: text;
            }
            #slippylist > li.demo-allow-select span {
                cursor: text;
            }

            .CodeMirror {
                border: 1px solid rgba(0,0,0,0.2);
            }

            .schema-delete svg, .schema-reorder svg {
                width: 24px;
                height: 24px;
            }
            .schema-default, .schema-enable, .config-showsource-toggle-icon, .config-allowcustom-toggle-icon {
                width: 24px;
                height: 24px;
                background-image: url(../components/material-design-icons/sprites/svg-sprite/svg-sprite-toggle.svg);
            }
            .download-icon {
                display: inline-block;
                margin-right: 10px;
                width: 24px;
                height: 24px;
                vertical-align: middle;
            }
            .download-icon svg{
                fill: #FFF;
            }
            .date-icon {
                display: inline-block;
                margin-right: 10px;
                width: 24px;
                height: 24px;
                vertical-align: middle;
                background-position: 0 -912px;
                background-image: url(../images/svg-sprite-action-black.svg);
            }
            .schema-default, .schema-delete, .schema-enable, .schema-reorder {
                cursor: pointer;
                background-repeat: no-repeat;
            }

            .schema-default {
                display: inline-block;
                width: 24px;
                height: 24px;
                vertical-align: middle;
                background-position: 0 -144px;
            }
            .schema-enable {
                display: inline-block;
                width: 24px;
                height: 24px;
                vertical-align: middle;
                background-position: 0 -24px;
            }

            .schema-is-default .schema-default {
                background-position: 0 -96px;
            }
            .schema-is-enabled .schema-enable {
                background-position: 0 0;
            }
            .schema {
                opacity: 0.25;
            }
            .schema.schema-is-enabled {
                opacity: 1;
            }
            .schema.schema-is-invalid {
                background: #FBC2C4 !important;
            }
            .schema-name {
                display: inline-block;
            }
            .schemas:empty:after {
                width: 100px;
                height: 100px;
                content: "No Schemas defined.";
            }
            .schema-reorder {
                float: right;
                width: 24px;
                height: 24px;
                vertical-align: middle;
                background-position: 0 -2208px;
            }
            .schema-delete {
                margin-right: 20px;
                float: right;
                width: 24px;
                height: 24px;
                vertical-align: middle;
                background-position: 0 -792px;
            }
            .schema-name{
                cursor: pointer;
            }
            .schema-header{
                -webkit-user-select: none;  /* Chrome all / Safari all */
                -moz-user-select: none;     /* Firefox all */
                -ms-user-select: none;      /* IE 10+ */
                padding: 1em;
            }
            .schema-body {
                width: 100%;
                padding: 1em;
                border-top: 1px solid rgba(0,0,0,0.2);
                display: inline-block;
                background: rgba(0,0,0,0.01);
            }

            .CodeMirror-drag-handel {
                position: absolute;
                right:30px;
                margin-top: -20px;
                width: 20px;
                height: 20px;
                border-top: 10px solid rgba(0,0,0,0);
                border-bottom: 10px solid rgba(0,0,0,0.2);
                border-left: 10px solid rgba(0,0,0,0);
                border-right: 10px solid rgba(0,0,0,0.2);
                z-index: 3;
                cursor: pointer;
            }

            .datetimepicker svg {
                width: 16px;
                height: 16px;
            }

            .line-error {
                background: #FBC2C4 !important;
                color: #8a1f11 !important;
            }

            .schema-input-schema-results {
                width: 100%;
                border-left: 1px solid rgba(0,0,0,0.2);
                border-right: 1px solid rgba(0,0,0,0.2);
                border-bottom: 1px solid rgba(0,0,0,0.2);
                padding: 8px;
            }
            .schema-input-schema-results.schema-input-schema-invalid {
                display: none;
            }
            .schema-input-schema-results.schema-input-schema-invalid {
                display: block;
                background-color: #e3b5af;
            }

            .schema-input-schema-results.schema-input-schema-valid {
                display: block;
                background-color: #bfe3b2;
            }

            .config-showsource-toggle, .config-allowcustom-toggle {
                cursor: pointer;
                padding: 4px;
            }

            .config-showsource-toggle-icon, .config-allowcustom-toggle-icon {
                margin-right: 10px;
                display: inline-block;
                width: 24px;
                height: 24px;
                vertical-align: middle;
                background-position: 0 -2208px;
            }
            .config-showsource .config-showsource-toggle-icon, .config-allowcustom .config-allowcustom-toggle-icon{
                background-position: 0 0;
            }

            .bootstrap-tagsinput {
                margin:0px;
                border-top-left-radius: 0 px;
                border-bottom-left-radius: 0 px;
            }
            .bootstrap-tagsinput .tag.big{
                background: #0088cc;
                padding: 2px;
                border-radius: 3px;
            }
            .bootstrap-tagsinput .tag.big{
                border-radius: 3px;
            }
            h2 {
                margin-top: 10px;
                margin-bottom: 5px;
                font-size: 25px;
            }

        </style>
    </head>
    <body>

        <div class="container-fluid">
            <div class="row">
                <div class="lead well">
                    <h2>Validata: Admin</h2>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3">
                    <div class="panel panel-default panel-success">
                        <div class="panel-heading">
                            <h3 class="panel-title">Import</h3>
                        </div>
                        <div class="panel-body">
                            <p>Warning: Loading a new configuration will overwrite any existing data for this page.</p>
                            <input id="import-file" type="file" />
                        </div>
                    </div>
                    <div class="panel panel-default panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Configuration Options</h3>
                        </div>
                        <div class="panel-body">
                            <div class="config-showsource-toggle">
                                <div class="config-showsource-toggle-icon"></div>
                                Show Source Button
                            </div>
                            <div class="config-allowcustom-toggle">
                                <div class="config-allowcustom-toggle-icon"></div>
                                Allow Custom Schema
                            </div>
                        </div>
                    </div>
                    <div class="panel panel-default panel-info">
                        <div class="panel-heading">
                            <h3 class="panel-title">Export</h3>
                        </div>
                        <div class="panel-body">
                            <a class="btn btn-primary download-file">
                                <div class="download-icon">
                                    <svg viewBox="0 192 24 24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                        <use xlink:href="/images/svg-sprite/svg-sprite-file.svg#ic_file_download_24px"></use>
                                    </svg>
                                </div>
                                Download File
                            </a>
                        </div>
                    </div>
                    <div class="panel panel-default panel-default panel-help">
                        <div class="panel-heading">
                            <h3 class="panel-title">Help</h3>
                        </div>
                        <div class="panel-body">
                            ShEx documentation
                        </div>
                        <div class="panel-body">
                            <table class="table table-condensed">
                                <tr>
                                    <td>Name Term</td>
                                    <td><code>ex:state</code></td>
                                </tr>
                                <tr>
                                    <th colspan="2">Rules</th>
                                </tr>
                                <tr>
                                    <td>Arc Rule</td>
                                    <td><code>foaf:givenName xsd:string+</code></td>
                                </tr>
                                <tr>
                                    <td>And Rule</td>
                                    <td><samp>foaf:givenName xsd:string<code>,</code><br>
                                        foaf:familyName xsd:string</samp></td>
                                </tr>
                                <tr>
                                    <td>Or rule</td>
                                    <td><code>(</code><samp>foaf:givenName xsd:string </samp><code>|</code><samp><br>
                                        foaf:name xsd:string </samp><code>)</code></td>
                                </tr>
                                <tr>
                                    <td>Group Rule</td>
                                    <td><samp><code>(</code> foaf:givenName xsd:string<code>,</code><br>
                                        foaf:familyName xsd:string <code>)</code></samp></td>
                                </tr>
                                <tr>
                                    <th colspan="2">Cardinality</th>
                                </tr>
                                <tr>
                                    <td colspan="2">Applying no cardinality constraint means a rule must exist once.</td>
                                </tr>
                                <tr>
                                    <td>x∈{0,1}</td>
                                    <td><samp>foaf:givenName xsd:string<code>?</code></samp></td>
                                </tr>
                                <tr>
                                    <td>x≥1</td>
                                    <td><samp>foaf:givenName xsd:string<code>+</code></samp></td>
                                </tr>
                                <tr>
                                    <td>x≥0</td>
                                    <td><samp>foaf:givenName xsd:string<code>*</code></samp></td>
                                </tr>
                                <tr>
                                    <td>x=n</td>
                                    <td><samp>foaf:givenName xsd:string<code>{</code>n<code>}</code></samp><br>
                                        <samp>foaf:givenName xsd:string<code>{3}</code></samp></td>
                                </tr>
                                <tr>
                                    <td>n≥x≥m</td>
                                    <td><samp>foaf:givenName xsd:string<code>{</code>n<code>,</code>m<code>}</code></samp>
                                        <samp>foaf:givenName xsd:string<code>{3,6}</code></samp></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="col-md-9">
                    <ol style="display:none;">
                        <li class="list-group-item schema-demo schema-demo-template">
                            <div class="input-group schema-demo-name">
                                <span class="input-group-addon">Name</span>
                                <input type="text" class="form-control schema-demo-name-input" placeholder="Untitled Demo">
                                <span class="input-group-btn">
                                    <button class="btn btn-danger schema-demo-delete" type="button">Delete Demo</button>
                                </span>
                            </div>
                            <div class="schema-input-demo-data">
                                <textarea class="schema-demo-data-input"></textarea>
                                <div class="CodeMirror-drag-handel"></div>
                            </div>
                        </li>
                    </ol>
                    <ol style="display:none;">
                        <li class="schema schema-is-enabled schema-template">
                            <div class="schema-header">
                                <div class="schema-enable" title="Toggle visibility"></div>
                                <div class="schema-default" title="Toggle Default"></div>
                                <div class="schema-name">Untitled Schema</div>
                                <div class="schema-reorder">
                                    <svg viewBox="0 2208 24 24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                        <use xlink:href="/images/svg-sprite/svg-sprite-action.svg#ic_reorder_24px"></use>
                                    </svg>
                                </div>
                                <div class="schema-delete">
                                    <svg viewBox="0 792 24 24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                        <use xlink:href="/images/svg-sprite/svg-sprite-action.svg#ic_delete_24px"></use>
                                    </svg>
                                </div>
                            </div>
                            <div class="schema-body">
                                <div class="input-group schema-input-name">
                                    <span class="input-group-addon">Name</span>
                                    <input type="text" class="form-control schema-input-name-input" placeholder="Untitled Schema">
                                </div>
                                <div class="input-group schema-input-description">
                                    <span class="input-group-addon">Description</span>
                                    <input type="text" class="form-control schema-input-description-input">
                                </div>
                                <div class="schema-input-creationdate">
                                    <div class='input-group date datetimepicker'>
                                        <span class="input-group-addon">Creation Date</span>
                                        <input type='text' class="schema-input-creationdate-input form-control" />
                                        <span class="input-group-addon">
                                            <svg viewBox="0 912 24 24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                                <use xlink:href="/images/svg-sprite/svg-sprite-action.svg#ic_event_24px"></use>
                                            </svg>
                                        </span>
                                    </div>
                                </div>
                                <div class="schema-input-modificationdate">
                                    <div class='input-group date datetimepicker'>
                                        <span class="input-group-addon">Modification Date</span>
                                        <input type='text' class="schema-input-modificationdate-input form-control" />
                                        <span class="input-group-addon">
                                            <svg viewBox="0 912 24 24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                                <use xlink:href="/images/svg-sprite/svg-sprite-action.svg#ic_event_24px"></use>
                                            </svg>
                                        </span>
                                    </div>
                                </div>
                                <div class="schema-input-requirementlevels">
                                    <div class='input-group'>
                                        <span class="input-group-addon">Requirement Levels</span>
                                        <input type="text" value="" class="schema-input-requirementlevels-input form-control"/>
                                    </div>
                                </div>
                                <div class="schema-input-schema">
                                    <textarea class="schema-input-schema-input"></textarea>
                                    <div class="CodeMirror-drag-handel"></div>
                                    <div class="schema-input-schema-results"></div>
                                </div>
                                <h4>Demos (Turtle, TriG, N-Triples or N-Quads)</h4>
                                <p>Add RDF data here that can be used to demonstrate that the validator works correctly.</p>
                                <ul class="list-group schema-demos">
                                </ul>
                                <button class="btn btn-success schema-new-demo">Add New Demo</button>
                            </div>
                        </li>
                    </ol>
                    <ol id="slippylist" class="schemas"></ol>
                    <button class="btn btn-success btn-md create-new-schema">Add New Schema</button>
                </div>
            </div>

        </div>
        
        <script src="components/jquery/dist/jquery.js"></script>
        <script src="components/moment/min/moment.min.js"></script>
        <script src="components/bootstrap/dist/js/bootstrap.js"></script>
        <script src="components/bootstrap-switch/dist/js/bootstrap-switch.min.js"></script>
        <script src="components/slip/slip.js"></script>
        <script src="components/codemirror/lib/codemirror.js"></script>
        <script src="components/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
        <!--<script src="components/bootstrap-tagsinput/dist/bootstrap-tagsinput.js"></script>-->

        <script src="javascripts/ShExValidator.js"></script>
        <script src="javascripts/Log.js"></script>
        <script src="javascripts/Util.js"></script>
        <script src="javascripts/admin/UI.js"></script>
        <script src="javascripts/admin/Validata.js"></script>
        <script src="javascripts/admin/DocumentReady.js"></script>
        <script>
            $(document).ready(function(){
                $(".panel-help").find(".panel-body").hide();
            });
            $(".panel").find(".panel-heading").click(function(){
                $(this).parent().find(".panel-body").slideToggle();
            });
            var setAllowCustom = function setAllowCustom(t){
                if(t)
                    $(".config-allowcustom-toggle").addClass("config-allowcustom");
                else
                    $(".config-allowcustom-toggle").removeClass("config-allowcustom");
            };
            var setShowSource = function setShowSource(t){
                if(t)
                    $(".config-showsource-toggle").addClass("config-showsource");
                else
                    $(".config-showsource-toggle").removeClass("config-showsource");
            };
            var getAllowCustom = function getAllowCustom(){
                return $(".config-allowcustom-toggle").hasClass("config-allowcustom");
            };
            var getShowSource = function getShowSource(){
                return $(".config-showsource-toggle").hasClass("config-showsource");
            };
            $(".config-allowcustom-toggle").click(function(){
                if(getAllowCustom()){
                    setAllowCustom(false);
                } else {
                    setAllowCustom(true);
                }
            });
            $(".config-showsource-toggle").click(function(){
                if(getShowSource()){
                    setShowSource(false);
                } else {
                    setShowSource(true);
                }
            });
            var deleteSchema = function deleteSchema(schema){
                $(schema).fadeOut(350,function(){
                    $(this).remove();
                    var schemas = getAllSchemas();
                    if(schemas.length!=0){
                        for(var i=schemas.length-1;i>=0;i--){
                            defaultSchema(schemas[i]);
                        }
                    }
                });
            };
            var enableSchema = function enableSchema(schema){
                if($(schema).hasClass("schema-is-enabled") && !$(schema).hasClass("schema-is-default")){
                    $(schema).removeClass("schema-is-enabled");
                } else {
                    $(schema).addClass("schema-is-enabled");
                }
            };
            var defaultSchema = function defaultSchema(schema){
                if($(schema).hasClass("schema-is-enabled")){
                    getAllSchemas().each(function( index ) {
                        $(this).removeClass("schema-is-default");
                    });
                    $(schema).addClass("schema-is-default");
                }
            };
            var setSchemaEnable = function setSchemaDefault(schema,t){
                if(t)
                    $(schema).addClass("schema-is-enabled");
                else
                    $(schema).removeClass("schema-is-enabled");
            };
            var setSchemaDefault = function setSchemaDefault(schema,t){
                if(t)
                    $(schema).addClass("schema-is-default");
                else
                    $(schema).removeClass("schema-is-default");
            };
            var setSchemaName = function setSchemaName(schema,name){
                $(schema).find(".schema-input-name-input").val(name).trigger("input");
            };
            var setSchemaDescription = function setSchemaDescription(schema,description){
                $(schema).find(".schema-input-description-input").val(description).trigger("input");
            };
            var setSchemaCreationDate = function setSchemaCreationdate(schema,creationDate){
                $(schema).find(".schema-input-creationdate-input").val(moment.unix(creationDate).format()).trigger("input");
            };
            var setSchemaModificationDate = function setSchemaModifieddate(schema,modifiedDate){
                $(schema).find(".schema-input-modifieddata-input").val(moment.unix(modifiedDate).format()).trigger("input");
            };
            var setRequirementLevels = function setRequirementLevels(schema,data){
                if(data!=undefined){
                    $(schema).find(".schema-input-requirementlevels-input").val(data.join());
                }
            };
            var setSchemaData = function setSchemaData(schema,data){
                $(schema).data("schemaInput").setValue(data);
            };
            var setDemoName = function setSchemaName(demo,name){
                $(demo).find(".schema-demo-name-input").val(name);
            };
            var setDemoData = function setDemoData(demo,data){
                $(demo).data("demoInput").setValue(data);
            };

            var getAllSchemas = function getAllSchemas(){
                return $(".schemas").find(".schema");
            };
            var addConfiguration = function addConfiguration(json){
                if("options" in json){
                    setAllowCustom(json.options.allowCustomSchema);
                    setShowSource(json.options.showSourceButton);
                }
                if("schemas" in json){
                    for(var i=0;i<json.schemas.length;i++){
                        addSchema(json.schemas[i]);
                    }
                }
            };
            var addSchema = function addSchema(schemajson){
                var newSchema = createNewSchema();
                setSchemaDefault(newSchema,schemajson.default);
                setSchemaEnable(newSchema,schemajson.enabled);
                setSchemaName(newSchema,schemajson.name);
                setSchemaDescription(newSchema,schemajson.description);
                setSchemaCreationDate(newSchema,schemajson.creationDate);
                setSchemaModificationDate(newSchema,schemajson.modificationDate);
                setRequirementLevels(newSchema,schemajson.reqLevels);
                setSchemaData(newSchema,schemajson.data);
                for(var i=0;i<schemajson.dataDemos.length;i++){
                    addDemo(newSchema,schemajson.dataDemos[i]);
                }
                return newSchema;
            };
            var addDemo = function addDemo(schema,demojson){
                var newDemo = createNewDemo(schema);
                setDemoName(newDemo,demojson.name);
                setDemoData(newDemo,demojson.data);
                return newDemo;
            };
            var exportSchema = function exportSchema(schema){
                s = {};
                s.default = $(schema).hasClass("schema-is-default");
                s.enabled =         $(schema).hasClass("schema-is-enabled");
                s.name =            $(schema).find(".schema-name").text();
                s.description =     $(schema).find(".schema-input-description-input").val();
                s.creationDate =    moment($(schema).find(".schema-input-creationdate-input").val()).unix();
                s.modificationDate =moment($(schema).find(".schema-input-modificationdate-input").val()).unix();
                if($(schema).find("schema-input-requirementlevels-input").val()!=""){
                    s.reqLevels =   $(schema).find("schema-input-requirementlevels-input").val().split(",");
                }
                s.data =            $.data( schema, "schemaInput").getValue();
                s.dataDemos =       [];
                var demos = $(schema).find(".schema-demo");
                for(var i=0;i<demos.length;i++){
                    var d = {};
                    d.name = $(demos[i]).find(".schema-demo-name-input").val();
                    d.data = $.data( demos[i], "demoInput").getValue();
                    s.dataDemos.push(d);
                }
                return s;
            };
            var exportConfiguration = function exportConfiguration(){
                var json = {};

                // Export schema data
                json.schemas = [];
                var schemas = getAllSchemas();
                for(var i=0;i<schemas.length;i++){
                    json.schemas.push(exportSchema(schemas[i]));
                }

                // Export option data
                json.options = {};
                json.options.showSourceButton = getShowSource();
                json.options.allowCustomSchema = getAllowCustom();
                return json;
            };
            var createNewDemo = function createNewDemo(schema){
                var newDemo = $(".schema-demo-template").clone();
                newDemo.find(".schema-demo-delete").click(function(e){
                    $(this).parent().parent().parent().fadeOut(350,function(){$(this).remove();});
                    e.stopPropagation();
                });
                newDemo.removeClass("schema-demo-template");
                newDemo.appendTo(schema.find(".schema-demos"));
                var demoInput = CodeMirror.fromTextArea(newDemo.find(".schema-demo-data-input").get(0), {
                    lineNumbers: true
                });
                $(newDemo).data("demoInput",demoInput);
                return newDemo;
            };
            var createNewSchema = function createNewSchema(){
                var newSchema = $(".schema-template").clone();
                newSchema.removeClass("schema-template");

                // Set the schema as default if this is the first one added
                if(getAllSchemas().length==0){
                    newSchema.addClass("schema-is-default");
                }

                newSchema.find(".schema-delete").click(function(e){
                    deleteSchema(newSchema);
                    e.stopPropagation();
                });
                newSchema.find(".schema-enable").click(function(e){
                    enableSchema(newSchema);
                    e.stopPropagation();
                });
                newSchema.find(".schema-default").click(function(e){
                    defaultSchema(newSchema);
                    e.stopPropagation();
                });
                newSchema.find(".schema-reorder").click(function(e){
                    e.stopPropagation();
                });
                newSchema.find(".schema-header").click(function(){
                    $(this).parent().find(".schema-body").slideToggle();
                });
                newSchema.find(".schema-input-name-input").on("input propertychange paste",function(e){
                    if($(this).val()!=""){
                        $(this).parent().parent().parent().find(".schema-name").html($(this).val());
                    } else {
                        $(this).parent().parent().parent().find(".schema-name").html("Untitled Schema");
                    }
                });
                newSchema.find(".schema-input-name-input").on("input propertychange paste", function(e){
                    if(moment($(this).val()).isValid()){
                        $(this).parent().parent().addClass("has-error");
                    } else {
                        $(this).parent().parent().removeClass("has-error");
                    }
                });
                newSchema.find(".schema-input-creationdate-input").val(moment().format());
                newSchema.find(".schema-input-modificationdate-input").val(moment().format());
                newSchema.find(".schema-new-demo").click(function(){
                    createNewDemo(newSchema);
                });
                newSchema.find(".datetimepicker").datetimepicker({
                    format: 'YYYY-MM-DDTHH:mm:ssZ'
                });
                newSchema.appendTo(".schemas");
                var schemaInputField = newSchema.find(".schema-input-schema-input").get(0);
                var schemaInput = CodeMirror.fromTextArea(schemaInputField, {
                    lineNumbers: true
                });
                $(newSchema).data("schemaInput",schemaInput);
                console.log($(newSchema).data("schemaInput"));
                var schemaInputOutput = newSchema.find(".schema-input-schema-results");
                var oldLine = undefined;

                schemaInput.on("change", function() {
                    var callbacks = {
                        schemaParsed: function schemaParsedCallback(responseObject) {
                            schemaInputOutput.removeClass("schema-input-schema-invalid");
                            schemaInputOutput.addClass("schema-input-schema-valid");
                            schemaInputOutput.text("Successfully parsed!");
                            newSchema.removeClass("schema-is-invalid");
                        },
                        schemaParseError: function schemaParseErrorCallback(responseObject) {
                            schemaInputOutput.removeClass("schema-input-schema-valid");
                            schemaInputOutput.addClass("schema-input-schema-invalid");
                            var errorMessage = 'Line '+responseObject.line+', Column '+responseObject.column+
                                ' : '+responseObject.message;
                            schemaInputOutput.text(errorMessage);
                            schemaInput.addLineClass(responseObject.line-1, 'background', 'line-error');
                            oldLine = responseObject.line-1;
                            newSchema.addClass("schema-is-invalid");
                        }
                    };
                    Util.waitForFinalEvent(function waitForFinalEventCallback() {
                        if(oldLine!=undefined) {
                            schemaInput.removeLineClass(oldLine, 'background', 'line-error');
                        }
                        var validator = new ShExValidator.Validator(schemaInput.getValue(), "", callbacks, {});
                    }, 500, "schemaValidator");
                });
                return newSchema;
            };

            var ol = document.getElementById('slippylist');
            ol.addEventListener('slip:beforereorder', function(e){
                console.log($(this));
                console.log($(e));
                $(".schemas .schema-body").hide();
                if (/demo-no-reorder/.test(e.target.className)) {
                    e.preventDefault();
                }
            }, false);

            ol.addEventListener('slip:beforeswipe', function(e){
                e.preventDefault();
            }, false);

            ol.addEventListener('slip:beforewait', function(e){
                var a = $(e.target).hasClass('schema-reorder');
                var b = $(e.target).parent().hasClass('schema-reorder');
                var c = $(e.target).parent().parent().hasClass('schema-reorder');
                if ( a || b || c) e.preventDefault();
            }, false);

            ol.addEventListener('slip:afterswipe', function(e){
                //e.target.parentNode.appendChild(e.target);
            }, false);

            ol.addEventListener('slip:reorder', function(e){
                e.target.parentNode.insertBefore(e.target, e.detail.insertBefore);
                return false;
            }, false);

            new Slip(ol);

            $(".create-new-schema").click(function(){
                createNewSchema();
            });

            $(function () {
                $('.datetimepicker').datetimepicker();
            });

            // Selecting a file using the file chooser should cause the content of that file to be loaded into the data source div as text
            $("#import-file").change(function() {

                console.log("hei");

                var inputFiles = this.files;

                if (inputFiles == undefined || inputFiles.length == 0) {
                    return;
                }
                var inputFile = inputFiles[0];

                var reader = new FileReader();

                reader.onload = function (event) {
                    console.log(event.target.result);
                    addConfiguration(JSON.parse(event.target.result));
                };

                reader.onerror = function (event) {
                    console.log("he3");
                    var errorMessage = "Selected file could not be uploaded. Error: " + event.target.error.code;
                    alert(errorMessage);
                };

                reader.readAsText(inputFile);
            });

            $(".download-file").on('click', function(){

                // create json object from schema array
                var config = exportConfiguration();
                var data = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(config));
                $(this).attr('href',data);
                $(this).attr('download',"ValidataConfig.json");
            })

        </script>

    </body>
</html>